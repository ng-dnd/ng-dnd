import{Bb as ue,Cb as le,Pa as ie,Qb as pe,Ra as ne,Rb as O,Sb as M,Ya as L,Za as se,ab as S,ea as te,gb as re,ja as E,jb as oe,kc as fe,lc as $,mb as R,n as Z,qb as B,rb as A,tb as ae,vc as ve,w as ee,wb as I,wc as ge,xb as de,yb as he,zb as ce,zc as W}from"./chunk-C7W2QAC5.js";var me=(t,e,n)=>{if(!e.has(t))throw TypeError("Cannot "+n)},a=(t,e,n)=>(me(t,e,"read from private field"),n?n.call(t):e.get(t)),v=(t,e,n)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},T=(t,e,n,r)=>(me(t,e,"write to private field"),r?r.call(t,n):e.set(t,n),n),b,Me=class{constructor(){v(this,b,void 0),this.register=t=>{a(this,b).push(t)},this.unregister=t=>{let e;for(;(e=a(this,b).indexOf(t))!==-1;)a(this,b).splice(e,1)},this.backendChanged=t=>{for(let e of a(this,b))e.backendChanged(t)},T(this,b,[])}};b=new WeakMap;var p,x,f,m,y,Q,X,q,H,F,k,ye=class j{constructor(e,n,r){if(v(this,p,void 0),v(this,x,void 0),v(this,f,void 0),v(this,m,void 0),v(this,y,void 0),v(this,Q,(i,s,o)=>{if(!o.backend)throw new Error(`You must specify a 'backend' property in your Backend entry: ${JSON.stringify(o)}`);let d=o.backend(i,s,o.options),h=o.id,u=!o.id&&d&&d.constructor;if(u&&(h=d.constructor.name),h)u&&console.warn(`Deprecation notice: You are using a pipeline which doesn't include backends' 'id'.
        This might be unsupported in the future, please specify 'id' explicitely for every backend.`);else throw new Error(`You must specify an 'id' property in your Backend entry: ${JSON.stringify(o)}
        see this guide: https://github.com/louisbrunner/dnd-multi-backend/tree/master/packages/react-dnd-multi-backend#migrating-from-5xx`);if(a(this,f)[h])throw new Error(`You must specify a unique 'id' property in your Backend entry:
        ${JSON.stringify(o)} (conflicts with: ${JSON.stringify(a(this,f)[h])})`);return{id:h,instance:d,preview:o.preview??!1,transition:o.transition,skipDispatchOnTransition:o.skipDispatchOnTransition??!1}}),this.setup=()=>{if(!(typeof window>"u")){if(j.isSetUp)throw new Error("Cannot have two MultiBackends at the same time.");j.isSetUp=!0,a(this,X).call(this,window),a(this,f)[a(this,p)].instance.setup()}},this.teardown=()=>{typeof window>"u"||(j.isSetUp=!1,a(this,q).call(this,window),a(this,f)[a(this,p)].instance.teardown())},this.connectDragSource=(i,s,o)=>a(this,k).call(this,"connectDragSource",i,s,o),this.connectDragPreview=(i,s,o)=>a(this,k).call(this,"connectDragPreview",i,s,o),this.connectDropTarget=(i,s,o)=>a(this,k).call(this,"connectDropTarget",i,s,o),this.profile=()=>a(this,f)[a(this,p)].instance.profile(),this.previewEnabled=()=>a(this,f)[a(this,p)].preview,this.previewsList=()=>a(this,x),this.backendsList=()=>a(this,m),v(this,X,i=>{a(this,m).forEach(s=>{s.transition&&i.addEventListener(s.transition.event,a(this,H))})}),v(this,q,i=>{a(this,m).forEach(s=>{s.transition&&i.removeEventListener(s.transition.event,a(this,H))})}),v(this,H,i=>{let s=a(this,p);if(a(this,m).some(o=>o.id!==a(this,p)&&o.transition&&o.transition.check(i)?(T(this,p,o.id),!0):!1),a(this,p)!==s){a(this,f)[s].instance.teardown(),Object.keys(a(this,y)).forEach(u=>{let g=a(this,y)[u];g.unsubscribe(),g.unsubscribe=a(this,F).call(this,g.func,...g.args)}),a(this,x).backendChanged(this);let o=a(this,f)[a(this,p)];if(o.instance.setup(),o.skipDispatchOnTransition)return;let d=i.constructor,h=new d(i.type,i);i.target?.dispatchEvent(h)}}),v(this,F,(i,s,o,d)=>a(this,f)[a(this,p)].instance[i](s,o,d)),v(this,k,(i,s,o,d)=>{let h=`${i}_${s}`,u=a(this,F).call(this,i,s,o,d);return a(this,y)[h]={func:i,args:[s,o,d],unsubscribe:u},()=>{a(this,y)[h].unsubscribe(),delete a(this,y)[h]}}),!r||!r.backends||r.backends.length<1)throw new Error(`You must specify at least one Backend, if you are coming from 2.x.x (or don't understand this error)
        see this guide: https://github.com/louisbrunner/dnd-multi-backend/tree/master/packages/react-dnd-multi-backend#migrating-from-2xx`);T(this,x,new Me),T(this,f,{}),T(this,m,[]),r.backends.forEach(i=>{let s=a(this,Q).call(this,e,n,i);a(this,f)[s.id]=s,a(this,m).push(s)}),T(this,p,a(this,m)[0].id),T(this,y,{})}};p=new WeakMap,x=new WeakMap,f=new WeakMap,m=new WeakMap,y=new WeakMap,Q=new WeakMap,X=new WeakMap,q=new WeakMap,H=new WeakMap,F=new WeakMap,k=new WeakMap,ye.isSetUp=!1;var xe=ye,ke=(t,e,n)=>new xe(t,e,n),C=(t,e)=>({event:t,check:e}),Ce=C("touchstart",t=>{let e=t;return e.touches!==null&&e.touches!==void 0}),De=C("dragstart",t=>t.type.indexOf("drag")!==-1||t.type.indexOf("drop")!==-1),Ne=C("mousedown",t=>t.type.indexOf("touch")===-1&&t.type.indexOf("mouse")!==-1),_e=C("pointerdown",t=>t.pointerType=="mouse");var Pe=["*"],G=(()=>{class t{constructor(){this.dnd=E(W),this.layer=this.dnd.dragLayer(),this.collect$=this.layer.listen(n=>({initialOffset:n.getInitialSourceClientOffset(),currentOffset:n.getSourceClientOffset()})),this.style$=this.collect$.pipe(ee(n=>{let{initialOffset:r,currentOffset:i}=n;if(!r||!i)return{display:"none"};let{x:s,y:o}=i,d=`translate(${s}px, ${o}px)`;return{transform:d,WebkitTransform:d}}))}ngOnDestroy(){this.layer.unsubscribe()}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275cmp=L({type:t,selectors:[["dnd-preview-renderer"]],ngContentSelectors:Pe,decls:3,vars:4,template:function(r,i){r&1&&(de(),B(0,"div"),O(1,"async"),he(2),A()),r&2&&oe(M(1,2,i.style$))},dependencies:[$],styles:["[_nghost-%COMP%]{display:block;position:fixed;pointer-events:none;z-index:100;left:0;top:0;width:100%;height:100%}"],changeDetection:0})}}return t})();var Le=(t,e,n)=>({$implicit:t,type:e,item:n});function Re(t,e){t&1&&ae(0)}function Be(t,e){if(t&1&&S(0,Re,1,0,"ng-container",0),t&2){let n=I(),r=I(2);re("ngTemplateOutlet",r.content)("ngTemplateOutletContext",pe(2,Le,n.itemType,n.itemType,n.item))}}function Ae(t,e){t&1&&(B(0,"dnd-preview-renderer"),S(1,Be,1,6,"ng-container"),A()),t&2&&(ie(),R(e.isDragging?1:-1))}function Ie(t,e){if(t&1&&(S(0,Ae,2,1,"dnd-preview-renderer"),O(1,"async")),t&2){let n,r=I();R((n=M(1,1,r.collect$))?0:-1,n)}}var $e=(()=>{class t{constructor(){this.dnd=E(W),this.manager=E(ve),this.allBackends=!1,this.layer=this.dnd.dragLayer(),this.previewEnabled$=new Z(!1),this.collect$=this.layer.listen(n=>({item:n.getItem(),itemType:n.getItemType(),isDragging:n.isDragging()})),this.warned=!1,this.manager==null?this.warn("no drag and drop manager defined, are you sure you imported DndModule?"):this.manager.getBackend().previewsList()?.register(this)}ngOnInit(){this.backendChanged(this.manager.getBackend())}backendChanged(n){this.previewEnabled$.next(this.isPreviewEnabled(n))}ngOnDestroy(){this.layer.unsubscribe(),this.manager.getBackend().previewsList()?.unregister(this)}warn(n){this.warned||console.warn(n),this.warned=!0}isPreviewEnabled(n){return this.allBackends?!0:n==null?(this.warn("no drag and drop backend defined, are you sure you imported DndModule.forRoot(backend)?"),!1):typeof n.previewEnabled!="function"?!0:n.previewEnabled()}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275cmp=L({type:t,selectors:[["dnd-preview"]],contentQueries:function(r,i,s){if(r&1&&ce(s,ne,5),r&2){let o;ue(o=le())&&(i.content=o.first)}},inputs:{allBackends:"allBackends"},decls:2,vars:3,consts:[[4,"ngTemplateOutlet","ngTemplateOutletContext"]],template:function(r,i){r&1&&(S(0,Ie,2,3),O(1,"async")),r&2&&R(M(1,1,i.previewEnabled$)?0:-1)},dependencies:[$,fe,G],encapsulation:2,changeDetection:0})}}return t})();var ut=(()=>{class t{static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275mod=se({type:t})}static{this.\u0275inj=te({})}}return t})();var w=function(t){return t.mouse="mouse",t.touch="touch",t.keyboard="keyboard",t}(w||{});var Y=class{get delay(){var e;return(e=this.args.delay)!==null&&e!==void 0?e:0}get scrollAngleRanges(){return this.args.scrollAngleRanges}get getDropTargetElementsAtPoint(){return this.args.getDropTargetElementsAtPoint}get ignoreContextMenu(){var e;return(e=this.args.ignoreContextMenu)!==null&&e!==void 0?e:!1}get enableHoverOutsideTarget(){var e;return(e=this.args.enableHoverOutsideTarget)!==null&&e!==void 0?e:!1}get enableKeyboardEvents(){var e;return(e=this.args.enableKeyboardEvents)!==null&&e!==void 0?e:!1}get enableMouseEvents(){var e;return(e=this.args.enableMouseEvents)!==null&&e!==void 0?e:!1}get enableTouchEvents(){var e;return(e=this.args.enableTouchEvents)!==null&&e!==void 0?e:!0}get touchSlop(){return this.args.touchSlop||0}get delayTouchStart(){var e,n,r,i;return(i=(r=(e=this.args)===null||e===void 0?void 0:e.delayTouchStart)!==null&&r!==void 0?r:(n=this.args)===null||n===void 0?void 0:n.delay)!==null&&i!==void 0?i:0}get delayMouseStart(){var e,n,r,i;return(i=(r=(e=this.args)===null||e===void 0?void 0:e.delayMouseStart)!==null&&r!==void 0?r:(n=this.args)===null||n===void 0?void 0:n.delay)!==null&&i!==void 0?i:0}get window(){if(this.context&&this.context.window)return this.context.window;if(typeof window<"u")return window}get document(){var e;if(!((e=this.context)===null||e===void 0)&&e.document)return this.context.document;if(this.window)return this.window.document}get rootElement(){var e;return((e=this.args)===null||e===void 0?void 0:e.rootElement)||this.document}constructor(e,n){this.args=e,this.context=n}};function Te(t,e,n,r){return Math.sqrt(Math.pow(Math.abs(n-t),2)+Math.pow(Math.abs(r-e),2))}function be(t,e,n,r,i){if(!i)return!1;let s=Math.atan2(r-e,n-t)*180/Math.PI+180;for(let o=0;o<i.length;++o){let d=i[o];if(d&&(d.start==null||s>=d.start)&&(d.end==null||s<=d.end))return!0}return!1}var We={Left:1,Right:2,Center:4},He={Left:0,Center:1,Right:2};function U(t){return t.button===void 0||t.button===He.Left}function Ee(t){return t.buttons===void 0||(t.buttons&We.Left)===0}function K(t){return!!t.targetTouches}var Fe=1;function Se(t){let e=t.nodeType===Fe?t:t.parentElement;if(!e)return;let{top:n,left:r}=e.getBoundingClientRect();return{x:r,y:n}}function je(t,e){if(t.targetTouches.length===1)return D(t.targetTouches[0]);if(e&&t.touches.length===1&&t.touches[0].target===e.target)return D(t.touches[0])}function D(t,e){return K(t)?je(t,e):{x:t.clientX,y:t.clientY}}var V=(()=>{let t=!1;try{addEventListener("test",()=>{},Object.defineProperty({},"passive",{get(){return t=!0,!0}}))}catch{}return t})();var N={[w.mouse]:{start:"mousedown",move:"mousemove",end:"mouseup",contextmenu:"contextmenu"},[w.touch]:{start:"touchstart",move:"touchmove",end:"touchend"},[w.keyboard]:{keydown:"keydown"}},z=class t{profile(){var e;return{sourceNodes:this.sourceNodes.size,sourcePreviewNodes:this.sourcePreviewNodes.size,sourcePreviewNodeOptions:this.sourcePreviewNodeOptions.size,targetNodes:this.targetNodes.size,dragOverTargetIds:((e=this.dragOverTargetIds)===null||e===void 0?void 0:e.length)||0}}get document(){return this.options.document}setup(){let e=this.options.rootElement;e&&(ge(!t.isSetUp,"Cannot have two Touch backends at the same time."),t.isSetUp=!0,this.addEventListener(e,"start",this.getTopMoveStartHandler()),this.addEventListener(e,"start",this.handleTopMoveStartCapture,!0),this.addEventListener(e,"move",this.handleTopMove),this.addEventListener(e,"move",this.handleTopMoveCapture,!0),this.addEventListener(e,"end",this.handleTopMoveEndCapture,!0),this.options.enableMouseEvents&&!this.options.ignoreContextMenu&&this.addEventListener(e,"contextmenu",this.handleTopMoveEndCapture),this.options.enableKeyboardEvents&&this.addEventListener(e,"keydown",this.handleCancelOnEscape,!0))}teardown(){let e=this.options.rootElement;e&&(t.isSetUp=!1,this._mouseClientOffset={},this.removeEventListener(e,"start",this.handleTopMoveStartCapture,!0),this.removeEventListener(e,"start",this.handleTopMoveStart),this.removeEventListener(e,"move",this.handleTopMoveCapture,!0),this.removeEventListener(e,"move",this.handleTopMove),this.removeEventListener(e,"end",this.handleTopMoveEndCapture,!0),this.options.enableMouseEvents&&!this.options.ignoreContextMenu&&this.removeEventListener(e,"contextmenu",this.handleTopMoveEndCapture),this.options.enableKeyboardEvents&&this.removeEventListener(e,"keydown",this.handleCancelOnEscape,!0),this.uninstallSourceNodeRemovalObserver())}addEventListener(e,n,r,i=!1){let s=V?{capture:i,passive:!1}:i;this.listenerTypes.forEach(function(o){let d=N[o][n];d&&e.addEventListener(d,r,s)})}removeEventListener(e,n,r,i=!1){let s=V?{capture:i,passive:!1}:i;this.listenerTypes.forEach(function(o){let d=N[o][n];d&&e.removeEventListener(d,r,s)})}connectDragSource(e,n){let r=this.handleMoveStart.bind(this,e);return this.sourceNodes.set(e,n),this.addEventListener(n,"start",r),()=>{this.sourceNodes.delete(e),this.removeEventListener(n,"start",r)}}connectDragPreview(e,n,r){return this.sourcePreviewNodeOptions.set(e,r),this.sourcePreviewNodes.set(e,n),()=>{this.sourcePreviewNodes.delete(e),this.sourcePreviewNodeOptions.delete(e)}}connectDropTarget(e,n){let r=this.options.rootElement;if(!this.document||!r)return()=>{};let i=s=>{if(!this.document||!r||!this.monitor.isDragging())return;let o;switch(s.type){case N.mouse.move:o={x:s.clientX,y:s.clientY};break;case N.touch.move:var d,h;o={x:((d=s.touches[0])===null||d===void 0?void 0:d.clientX)||0,y:((h=s.touches[0])===null||h===void 0?void 0:h.clientY)||0};break}let u=o!=null?this.document.elementFromPoint(o.x,o.y):void 0,g=u&&n.contains(u);if(u===n||g)return this.handleMove(s,e)};return this.addEventListener(this.document.body,"move",i),this.targetNodes.set(e,n),()=>{this.document&&(this.targetNodes.delete(e),this.removeEventListener(this.document.body,"move",i))}}getTopMoveStartHandler(){return!this.options.delayTouchStart&&!this.options.delayMouseStart?this.handleTopMoveStart:this.handleTopMoveStartDelay}installSourceNodeRemovalObserver(e){this.uninstallSourceNodeRemovalObserver(),this.draggedSourceNode=e,this.draggedSourceNodeRemovalObserver=new MutationObserver(()=>{e&&!e.parentElement&&(this.resurrectSourceNode(),this.uninstallSourceNodeRemovalObserver())}),!(!e||!e.parentElement)&&this.draggedSourceNodeRemovalObserver.observe(e.parentElement,{childList:!0})}resurrectSourceNode(){this.document&&this.draggedSourceNode&&(this.draggedSourceNode.style.display="none",this.draggedSourceNode.removeAttribute("data-reactid"),this.document.body.appendChild(this.draggedSourceNode))}uninstallSourceNodeRemovalObserver(){this.draggedSourceNodeRemovalObserver&&this.draggedSourceNodeRemovalObserver.disconnect(),this.draggedSourceNodeRemovalObserver=void 0,this.draggedSourceNode=void 0}constructor(e,n,r){this.getSourceClientOffset=i=>{let s=this.sourceNodes.get(i);return s&&Se(s)},this.handleTopMoveStartCapture=i=>{U(i)&&(this.moveStartSourceIds=[])},this.handleMoveStart=i=>{Array.isArray(this.moveStartSourceIds)&&this.moveStartSourceIds.unshift(i)},this.handleTopMoveStart=i=>{if(!U(i))return;let s=D(i);s&&(K(i)&&(this.lastTargetTouchFallback=i.targetTouches[0]),this._mouseClientOffset=s),this.waitingForDelay=!1},this.handleTopMoveStartDelay=i=>{if(!U(i))return;let s=i.type===N.touch.start?this.options.delayTouchStart:this.options.delayMouseStart;this.timeout=setTimeout(this.handleTopMoveStart.bind(this,i),s),this.waitingForDelay=!0},this.handleTopMoveCapture=()=>{this.dragOverTargetIds=[]},this.handleMove=(i,s)=>{this.dragOverTargetIds&&this.dragOverTargetIds.unshift(s)},this.handleTopMove=i=>{if(this.timeout&&clearTimeout(this.timeout),!this.document||this.waitingForDelay)return;let{moveStartSourceIds:s,dragOverTargetIds:o}=this,d=this.options.enableHoverOutsideTarget,h=D(i,this.lastTargetTouchFallback);if(!h)return;if(this._isScrolling||!this.monitor.isDragging()&&be(this._mouseClientOffset.x||0,this._mouseClientOffset.y||0,h.x,h.y,this.options.scrollAngleRanges)){this._isScrolling=!0;return}if(!this.monitor.isDragging()&&this._mouseClientOffset.hasOwnProperty("x")&&s&&Te(this._mouseClientOffset.x||0,this._mouseClientOffset.y||0,h.x,h.y)>(this.options.touchSlop?this.options.touchSlop:0)&&(this.moveStartSourceIds=void 0,this.actions.beginDrag(s,{clientOffset:this._mouseClientOffset,getSourceClientOffset:this.getSourceClientOffset,publishSource:!1})),!this.monitor.isDragging())return;let u=this.sourceNodes.get(this.monitor.getSourceId());this.installSourceNodeRemovalObserver(u),this.actions.publishDragSource(),i.cancelable&&i.preventDefault();let g=(o||[]).map(c=>this.targetNodes.get(c)).filter(c=>!!c),J=this.options.getDropTargetElementsAtPoint?this.options.getDropTargetElementsAtPoint(h.x,h.y,g):this.document.elementsFromPoint(h.x,h.y),_=[];for(let c in J){if(!J.hasOwnProperty(c))continue;let l=J[c];for(l!=null&&_.push(l);l;)l=l.parentElement,l&&_.indexOf(l)===-1&&_.push(l)}let P=_.filter(c=>g.indexOf(c)>-1).map(c=>this._getDropTargetId(c)).filter(c=>!!c).filter((c,l,Oe)=>Oe.indexOf(c)===l);if(d)for(let c in this.targetNodes){let l=this.targetNodes.get(c);if(u&&l&&l.contains(u)&&P.indexOf(c)===-1){P.unshift(c);break}}P.reverse(),this.actions.hover(P,{clientOffset:h})},this._getDropTargetId=i=>{let s=this.targetNodes.keys(),o=s.next();for(;o.done===!1;){let d=o.value;if(i===this.targetNodes.get(d))return d;o=s.next()}},this.handleTopMoveEndCapture=i=>{if(this._isScrolling=!1,this.lastTargetTouchFallback=void 0,!!Ee(i)){if(!this.monitor.isDragging()||this.monitor.didDrop()){this.moveStartSourceIds=void 0;return}i.cancelable&&i.preventDefault(),this._mouseClientOffset={},this.uninstallSourceNodeRemovalObserver(),this.actions.drop(),this.actions.endDrag()}},this.handleCancelOnEscape=i=>{i.key==="Escape"&&this.monitor.isDragging()&&(this._mouseClientOffset={},this.uninstallSourceNodeRemovalObserver(),this.actions.endDrag())},this.options=new Y(r,n),this.actions=e.getActions(),this.monitor=e.getMonitor(),this.sourceNodes=new Map,this.sourcePreviewNodes=new Map,this.sourcePreviewNodeOptions=new Map,this.targetNodes=new Map,this.listenerTypes=[],this._mouseClientOffset={},this._isScrolling=!1,this.options.enableMouseEvents&&this.listenerTypes.push(w.mouse),this.options.enableTouchEvents&&this.listenerTypes.push(w.touch),this.options.enableKeyboardEvents&&this.listenerTypes.push(w.keyboard)}};var Ye=function(e,n={},r={}){return new z(e,n,r)};export{ke as a,Ce as b,Ne as c,Ye as d,$e as e,ut as f};
