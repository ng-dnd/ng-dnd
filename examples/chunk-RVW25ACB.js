import{$a as S,Ib as $,Mb as fe,Nb as O,Ob as M,Qa as se,Ra as E,Sa as re,bb as oe,eb as ae,fa as ie,hb as R,kc as ve,lb as B,lc as W,mb as I,n as ee,na as L,oa as ne,ob as de,rb as A,sb as he,tb as ue,ub as ce,uc as ge,vc as me,w as te,wb as le,xb as pe,yc as F}from"./chunk-H5XLUPFI.js";var ye=(t,e,n)=>{if(!e.has(t))throw TypeError("Cannot "+n)},a=(t,e,n)=>(ye(t,e,"read from private field"),n?n.call(t):e.get(t)),v=(t,e,n)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},T=(t,e,n,s)=>(ye(t,e,"write to private field"),s?s.call(t,n):e.set(t,n),n),b,xe=class{constructor(){v(this,b,void 0),this.register=t=>{a(this,b).push(t)},this.unregister=t=>{let e;for(;(e=a(this,b).indexOf(t))!==-1;)a(this,b).splice(e,1)},this.backendChanged=t=>{for(let e of a(this,b))e.backendChanged(t)},T(this,b,[])}};b=new WeakMap;var p,x,f,m,y,X,q,G,H,j,k,we=class Y{constructor(e,n,s){if(v(this,p,void 0),v(this,x,void 0),v(this,f,void 0),v(this,m,void 0),v(this,y,void 0),v(this,X,(i,r,o)=>{if(!o.backend)throw new Error(`You must specify a 'backend' property in your Backend entry: ${JSON.stringify(o)}`);let d=o.backend(i,r,o.options),h=o.id,c=!o.id&&d&&d.constructor;if(c&&(h=d.constructor.name),h)c&&console.warn(`Deprecation notice: You are using a pipeline which doesn't include backends' 'id'.
        This might be unsupported in the future, please specify 'id' explicitely for every backend.`);else throw new Error(`You must specify an 'id' property in your Backend entry: ${JSON.stringify(o)}
        see this guide: https://github.com/louisbrunner/dnd-multi-backend/tree/master/packages/react-dnd-multi-backend#migrating-from-5xx`);if(a(this,f)[h])throw new Error(`You must specify a unique 'id' property in your Backend entry:
        ${JSON.stringify(o)} (conflicts with: ${JSON.stringify(a(this,f)[h])})`);return{id:h,instance:d,preview:o.preview??!1,transition:o.transition,skipDispatchOnTransition:o.skipDispatchOnTransition??!1}}),this.setup=()=>{if(!(typeof window>"u")){if(Y.isSetUp)throw new Error("Cannot have two MultiBackends at the same time.");Y.isSetUp=!0,a(this,q).call(this,window),a(this,f)[a(this,p)].instance.setup()}},this.teardown=()=>{typeof window>"u"||(Y.isSetUp=!1,a(this,G).call(this,window),a(this,f)[a(this,p)].instance.teardown())},this.connectDragSource=(i,r,o)=>a(this,k).call(this,"connectDragSource",i,r,o),this.connectDragPreview=(i,r,o)=>a(this,k).call(this,"connectDragPreview",i,r,o),this.connectDropTarget=(i,r,o)=>a(this,k).call(this,"connectDropTarget",i,r,o),this.profile=()=>a(this,f)[a(this,p)].instance.profile(),this.previewEnabled=()=>a(this,f)[a(this,p)].preview,this.previewsList=()=>a(this,x),this.backendsList=()=>a(this,m),v(this,q,i=>{a(this,m).forEach(r=>{r.transition&&i.addEventListener(r.transition.event,a(this,H))})}),v(this,G,i=>{a(this,m).forEach(r=>{r.transition&&i.removeEventListener(r.transition.event,a(this,H))})}),v(this,H,i=>{let r=a(this,p);if(a(this,m).some(o=>o.id!==a(this,p)&&o.transition&&o.transition.check(i)?(T(this,p,o.id),!0):!1),a(this,p)!==r){a(this,f)[r].instance.teardown(),Object.keys(a(this,y)).forEach(c=>{let g=a(this,y)[c];g.unsubscribe(),g.unsubscribe=a(this,j).call(this,g.func,...g.args)}),a(this,x).backendChanged(this);let o=a(this,f)[a(this,p)];if(o.instance.setup(),o.skipDispatchOnTransition)return;let d=i.constructor,h=new d(i.type,i);i.target?.dispatchEvent(h)}}),v(this,j,(i,r,o,d)=>a(this,f)[a(this,p)].instance[i](r,o,d)),v(this,k,(i,r,o,d)=>{let h=`${i}_${r}`,c=a(this,j).call(this,i,r,o,d);return a(this,y)[h]={func:i,args:[r,o,d],unsubscribe:c},()=>{a(this,y)[h].unsubscribe(),delete a(this,y)[h]}}),!s||!s.backends||s.backends.length<1)throw new Error(`You must specify at least one Backend, if you are coming from 2.x.x (or don't understand this error)
        see this guide: https://github.com/louisbrunner/dnd-multi-backend/tree/master/packages/react-dnd-multi-backend#migrating-from-2xx`);T(this,x,new xe),T(this,f,{}),T(this,m,[]),s.backends.forEach(i=>{let r=a(this,X).call(this,e,n,i);a(this,f)[r.id]=r,a(this,m).push(r)}),T(this,p,a(this,m)[0].id),T(this,y,{})}};p=new WeakMap,x=new WeakMap,f=new WeakMap,m=new WeakMap,y=new WeakMap,X=new WeakMap,q=new WeakMap,G=new WeakMap,H=new WeakMap,j=new WeakMap,k=new WeakMap,we.isSetUp=!1;var ke=we,Ce=(t,e,n)=>new ke(t,e,n),C=(t,e)=>({event:t,check:e}),De=C("touchstart",t=>{let e=t;return e.touches!==null&&e.touches!==void 0}),Ne=C("dragstart",t=>t.type.indexOf("drag")!==-1||t.type.indexOf("drop")!==-1),_e=C("mousedown",t=>t.type.indexOf("touch")===-1&&t.type.indexOf("mouse")!==-1),Pe=C("pointerdown",t=>t.pointerType=="mouse");var Re=["*"],V=(()=>{class t{constructor(n){this.dnd=n,this.layer=this.dnd.dragLayer(),this.collect$=this.layer.listen(s=>({initialOffset:s.getInitialSourceClientOffset(),currentOffset:s.getSourceClientOffset()})),this.style$=this.collect$.pipe(te(s=>{let{initialOffset:i,currentOffset:r}=s;if(!i||!r)return{display:"none"};let{x:o,y:d}=r,h=`translate(${o}px, ${d}px)`;return{transform:h,WebkitTransform:h}}))}ngOnDestroy(){this.layer.unsubscribe()}static{this.\u0275fac=function(s){return new(s||t)(E(F))}}static{this.\u0275cmp=L({type:t,selectors:[["dnd-preview-renderer"]],standalone:!0,features:[$],ngContentSelectors:Re,decls:3,vars:4,template:function(s,i){s&1&&(he(),B(0,"div"),O(1,"async"),ue(2),I()),s&2&&ae(M(1,2,i.style$))},dependencies:[W],styles:["[_nghost-%COMP%]{display:block;position:fixed;pointer-events:none;z-index:100;left:0;top:0;width:100%;height:100%}"],changeDetection:0})}}return t})();var Be=(t,e,n)=>({$implicit:t,type:e,item:n});function Ie(t,e){t&1&&de(0)}function Ae(t,e){if(t&1&&S(0,Ie,1,0,"ng-container",0),t&2){let n=A(),s=A(2);oe("ngTemplateOutlet",s.content)("ngTemplateOutletContext",fe(2,Be,n.itemType,n.itemType,n.item))}}function $e(t,e){t&1&&(B(0,"dnd-preview-renderer"),S(1,Ae,1,6,"ng-container"),I()),t&2&&(se(),R(e.isDragging?1:-1))}function We(t,e){if(t&1&&(S(0,$e,2,1,"dnd-preview-renderer"),O(1,"async")),t&2){let n,s=A();R((n=M(1,1,s.collect$))?0:-1,n)}}var Fe=(()=>{class t{constructor(n,s){this.dnd=n,this.manager=s,this.allBackends=!1,this.layer=this.dnd.dragLayer(),this.previewEnabled$=new ee(!1),this.collect$=this.layer.listen(i=>({item:i.getItem(),itemType:i.getItemType(),isDragging:i.isDragging()})),this.warned=!1,this.manager==null?this.warn("no drag and drop manager defined, are you sure you imported DndModule?"):this.manager.getBackend().previewsList()?.register(this)}ngOnInit(){this.backendChanged(this.manager.getBackend())}backendChanged(n){this.previewEnabled$.next(this.isPreviewEnabled(n))}ngOnDestroy(){this.layer.unsubscribe(),this.manager.getBackend().previewsList()?.unregister(this)}warn(n){this.warned||console.warn(n),this.warned=!0}isPreviewEnabled(n){return this.allBackends?!0:n==null?(this.warn("no drag and drop backend defined, are you sure you imported DndModule.forRoot(backend)?"),!1):typeof n.previewEnabled!="function"?!0:n.previewEnabled()}static{this.\u0275fac=function(s){return new(s||t)(E(F),E(ge))}}static{this.\u0275cmp=L({type:t,selectors:[["dnd-preview"]],contentQueries:function(s,i,r){if(s&1&&ce(r,re,5),s&2){let o;le(o=pe())&&(i.content=o.first)}},inputs:{allBackends:"allBackends"},standalone:!0,features:[$],decls:2,vars:3,consts:[[4,"ngTemplateOutlet","ngTemplateOutletContext"]],template:function(s,i){s&1&&(S(0,We,2,3),O(1,"async")),s&2&&R(M(1,1,i.previewEnabled$)?0:-1)},dependencies:[W,ve,V],encapsulation:2,changeDetection:0})}}return t})();var ut=(()=>{class t{static{this.\u0275fac=function(s){return new(s||t)}}static{this.\u0275mod=ne({type:t})}static{this.\u0275inj=ie({})}}return t})();var w=function(t){return t.mouse="mouse",t.touch="touch",t.keyboard="keyboard",t}(w||{});var U=class{get delay(){var e;return(e=this.args.delay)!==null&&e!==void 0?e:0}get scrollAngleRanges(){return this.args.scrollAngleRanges}get getDropTargetElementsAtPoint(){return this.args.getDropTargetElementsAtPoint}get ignoreContextMenu(){var e;return(e=this.args.ignoreContextMenu)!==null&&e!==void 0?e:!1}get enableHoverOutsideTarget(){var e;return(e=this.args.enableHoverOutsideTarget)!==null&&e!==void 0?e:!1}get enableKeyboardEvents(){var e;return(e=this.args.enableKeyboardEvents)!==null&&e!==void 0?e:!1}get enableMouseEvents(){var e;return(e=this.args.enableMouseEvents)!==null&&e!==void 0?e:!1}get enableTouchEvents(){var e;return(e=this.args.enableTouchEvents)!==null&&e!==void 0?e:!0}get touchSlop(){return this.args.touchSlop||0}get delayTouchStart(){var e,n,s,i;return(i=(s=(e=this.args)===null||e===void 0?void 0:e.delayTouchStart)!==null&&s!==void 0?s:(n=this.args)===null||n===void 0?void 0:n.delay)!==null&&i!==void 0?i:0}get delayMouseStart(){var e,n,s,i;return(i=(s=(e=this.args)===null||e===void 0?void 0:e.delayMouseStart)!==null&&s!==void 0?s:(n=this.args)===null||n===void 0?void 0:n.delay)!==null&&i!==void 0?i:0}get window(){if(this.context&&this.context.window)return this.context.window;if(typeof window<"u")return window}get document(){var e;if(!((e=this.context)===null||e===void 0)&&e.document)return this.context.document;if(this.window)return this.window.document}get rootElement(){var e;return((e=this.args)===null||e===void 0?void 0:e.rootElement)||this.document}constructor(e,n){this.args=e,this.context=n}};function be(t,e,n,s){return Math.sqrt(Math.pow(Math.abs(n-t),2)+Math.pow(Math.abs(s-e),2))}function Ee(t,e,n,s,i){if(!i)return!1;let r=Math.atan2(s-e,n-t)*180/Math.PI+180;for(let o=0;o<i.length;++o){let d=i[o];if(d&&(d.start==null||r>=d.start)&&(d.end==null||r<=d.end))return!0}return!1}var He={Left:1,Right:2,Center:4},je={Left:0,Center:1,Right:2};function K(t){return t.button===void 0||t.button===je.Left}function Se(t){return t.buttons===void 0||(t.buttons&He.Left)===0}function z(t){return!!t.targetTouches}var Ye=1;function Oe(t){let e=t.nodeType===Ye?t:t.parentElement;if(!e)return;let{top:n,left:s}=e.getBoundingClientRect();return{x:s,y:n}}function Ue(t,e){if(t.targetTouches.length===1)return D(t.targetTouches[0]);if(e&&t.touches.length===1&&t.touches[0].target===e.target)return D(t.touches[0])}function D(t,e){return z(t)?Ue(t,e):{x:t.clientX,y:t.clientY}}var Z=(()=>{let t=!1;try{addEventListener("test",()=>{},Object.defineProperty({},"passive",{get(){return t=!0,!0}}))}catch{}return t})();var N={[w.mouse]:{start:"mousedown",move:"mousemove",end:"mouseup",contextmenu:"contextmenu"},[w.touch]:{start:"touchstart",move:"touchmove",end:"touchend"},[w.keyboard]:{keydown:"keydown"}},J=class t{profile(){var e;return{sourceNodes:this.sourceNodes.size,sourcePreviewNodes:this.sourcePreviewNodes.size,sourcePreviewNodeOptions:this.sourcePreviewNodeOptions.size,targetNodes:this.targetNodes.size,dragOverTargetIds:((e=this.dragOverTargetIds)===null||e===void 0?void 0:e.length)||0}}get document(){return this.options.document}setup(){let e=this.options.rootElement;e&&(me(!t.isSetUp,"Cannot have two Touch backends at the same time."),t.isSetUp=!0,this.addEventListener(e,"start",this.getTopMoveStartHandler()),this.addEventListener(e,"start",this.handleTopMoveStartCapture,!0),this.addEventListener(e,"move",this.handleTopMove),this.addEventListener(e,"move",this.handleTopMoveCapture,!0),this.addEventListener(e,"end",this.handleTopMoveEndCapture,!0),this.options.enableMouseEvents&&!this.options.ignoreContextMenu&&this.addEventListener(e,"contextmenu",this.handleTopMoveEndCapture),this.options.enableKeyboardEvents&&this.addEventListener(e,"keydown",this.handleCancelOnEscape,!0))}teardown(){let e=this.options.rootElement;e&&(t.isSetUp=!1,this._mouseClientOffset={},this.removeEventListener(e,"start",this.handleTopMoveStartCapture,!0),this.removeEventListener(e,"start",this.handleTopMoveStart),this.removeEventListener(e,"move",this.handleTopMoveCapture,!0),this.removeEventListener(e,"move",this.handleTopMove),this.removeEventListener(e,"end",this.handleTopMoveEndCapture,!0),this.options.enableMouseEvents&&!this.options.ignoreContextMenu&&this.removeEventListener(e,"contextmenu",this.handleTopMoveEndCapture),this.options.enableKeyboardEvents&&this.removeEventListener(e,"keydown",this.handleCancelOnEscape,!0),this.uninstallSourceNodeRemovalObserver())}addEventListener(e,n,s,i=!1){let r=Z?{capture:i,passive:!1}:i;this.listenerTypes.forEach(function(o){let d=N[o][n];d&&e.addEventListener(d,s,r)})}removeEventListener(e,n,s,i=!1){let r=Z?{capture:i,passive:!1}:i;this.listenerTypes.forEach(function(o){let d=N[o][n];d&&e.removeEventListener(d,s,r)})}connectDragSource(e,n){let s=this.handleMoveStart.bind(this,e);return this.sourceNodes.set(e,n),this.addEventListener(n,"start",s),()=>{this.sourceNodes.delete(e),this.removeEventListener(n,"start",s)}}connectDragPreview(e,n,s){return this.sourcePreviewNodeOptions.set(e,s),this.sourcePreviewNodes.set(e,n),()=>{this.sourcePreviewNodes.delete(e),this.sourcePreviewNodeOptions.delete(e)}}connectDropTarget(e,n){let s=this.options.rootElement;if(!this.document||!s)return()=>{};let i=r=>{if(!this.document||!s||!this.monitor.isDragging())return;let o;switch(r.type){case N.mouse.move:o={x:r.clientX,y:r.clientY};break;case N.touch.move:var d,h;o={x:((d=r.touches[0])===null||d===void 0?void 0:d.clientX)||0,y:((h=r.touches[0])===null||h===void 0?void 0:h.clientY)||0};break}let c=o!=null?this.document.elementFromPoint(o.x,o.y):void 0,g=c&&n.contains(c);if(c===n||g)return this.handleMove(r,e)};return this.addEventListener(this.document.body,"move",i),this.targetNodes.set(e,n),()=>{this.document&&(this.targetNodes.delete(e),this.removeEventListener(this.document.body,"move",i))}}getTopMoveStartHandler(){return!this.options.delayTouchStart&&!this.options.delayMouseStart?this.handleTopMoveStart:this.handleTopMoveStartDelay}installSourceNodeRemovalObserver(e){this.uninstallSourceNodeRemovalObserver(),this.draggedSourceNode=e,this.draggedSourceNodeRemovalObserver=new MutationObserver(()=>{e&&!e.parentElement&&(this.resurrectSourceNode(),this.uninstallSourceNodeRemovalObserver())}),!(!e||!e.parentElement)&&this.draggedSourceNodeRemovalObserver.observe(e.parentElement,{childList:!0})}resurrectSourceNode(){this.document&&this.draggedSourceNode&&(this.draggedSourceNode.style.display="none",this.draggedSourceNode.removeAttribute("data-reactid"),this.document.body.appendChild(this.draggedSourceNode))}uninstallSourceNodeRemovalObserver(){this.draggedSourceNodeRemovalObserver&&this.draggedSourceNodeRemovalObserver.disconnect(),this.draggedSourceNodeRemovalObserver=void 0,this.draggedSourceNode=void 0}constructor(e,n,s){this.getSourceClientOffset=i=>{let r=this.sourceNodes.get(i);return r&&Oe(r)},this.handleTopMoveStartCapture=i=>{K(i)&&(this.moveStartSourceIds=[])},this.handleMoveStart=i=>{Array.isArray(this.moveStartSourceIds)&&this.moveStartSourceIds.unshift(i)},this.handleTopMoveStart=i=>{if(!K(i))return;let r=D(i);r&&(z(i)&&(this.lastTargetTouchFallback=i.targetTouches[0]),this._mouseClientOffset=r),this.waitingForDelay=!1},this.handleTopMoveStartDelay=i=>{if(!K(i))return;let r=i.type===N.touch.start?this.options.delayTouchStart:this.options.delayMouseStart;this.timeout=setTimeout(this.handleTopMoveStart.bind(this,i),r),this.waitingForDelay=!0},this.handleTopMoveCapture=()=>{this.dragOverTargetIds=[]},this.handleMove=(i,r)=>{this.dragOverTargetIds&&this.dragOverTargetIds.unshift(r)},this.handleTopMove=i=>{if(this.timeout&&clearTimeout(this.timeout),!this.document||this.waitingForDelay)return;let{moveStartSourceIds:r,dragOverTargetIds:o}=this,d=this.options.enableHoverOutsideTarget,h=D(i,this.lastTargetTouchFallback);if(!h)return;if(this._isScrolling||!this.monitor.isDragging()&&Ee(this._mouseClientOffset.x||0,this._mouseClientOffset.y||0,h.x,h.y,this.options.scrollAngleRanges)){this._isScrolling=!0;return}if(!this.monitor.isDragging()&&this._mouseClientOffset.hasOwnProperty("x")&&r&&be(this._mouseClientOffset.x||0,this._mouseClientOffset.y||0,h.x,h.y)>(this.options.touchSlop?this.options.touchSlop:0)&&(this.moveStartSourceIds=void 0,this.actions.beginDrag(r,{clientOffset:this._mouseClientOffset,getSourceClientOffset:this.getSourceClientOffset,publishSource:!1})),!this.monitor.isDragging())return;let c=this.sourceNodes.get(this.monitor.getSourceId());this.installSourceNodeRemovalObserver(c),this.actions.publishDragSource(),i.cancelable&&i.preventDefault();let g=(o||[]).map(u=>this.targetNodes.get(u)).filter(u=>!!u),Q=this.options.getDropTargetElementsAtPoint?this.options.getDropTargetElementsAtPoint(h.x,h.y,g):this.document.elementsFromPoint(h.x,h.y),_=[];for(let u in Q){if(!Q.hasOwnProperty(u))continue;let l=Q[u];for(l!=null&&_.push(l);l;)l=l.parentElement,l&&_.indexOf(l)===-1&&_.push(l)}let P=_.filter(u=>g.indexOf(u)>-1).map(u=>this._getDropTargetId(u)).filter(u=>!!u).filter((u,l,Me)=>Me.indexOf(u)===l);if(d)for(let u in this.targetNodes){let l=this.targetNodes.get(u);if(c&&l&&l.contains(c)&&P.indexOf(u)===-1){P.unshift(u);break}}P.reverse(),this.actions.hover(P,{clientOffset:h})},this._getDropTargetId=i=>{let r=this.targetNodes.keys(),o=r.next();for(;o.done===!1;){let d=o.value;if(i===this.targetNodes.get(d))return d;o=r.next()}},this.handleTopMoveEndCapture=i=>{if(this._isScrolling=!1,this.lastTargetTouchFallback=void 0,!!Se(i)){if(!this.monitor.isDragging()||this.monitor.didDrop()){this.moveStartSourceIds=void 0;return}i.cancelable&&i.preventDefault(),this._mouseClientOffset={},this.uninstallSourceNodeRemovalObserver(),this.actions.drop(),this.actions.endDrag()}},this.handleCancelOnEscape=i=>{i.key==="Escape"&&this.monitor.isDragging()&&(this._mouseClientOffset={},this.uninstallSourceNodeRemovalObserver(),this.actions.endDrag())},this.options=new U(s,n),this.actions=e.getActions(),this.monitor=e.getMonitor(),this.sourceNodes=new Map,this.sourcePreviewNodes=new Map,this.sourcePreviewNodeOptions=new Map,this.targetNodes=new Map,this.listenerTypes=[],this._mouseClientOffset={},this._isScrolling=!1,this.options.enableMouseEvents&&this.listenerTypes.push(w.mouse),this.options.enableTouchEvents&&this.listenerTypes.push(w.touch),this.options.enableKeyboardEvents&&this.listenerTypes.push(w.keyboard)}};var Ke=function(e,n={},s={}){return new J(e,n,s)};export{Ce as a,De as b,_e as c,Ke as d,Fe as e,ut as f};
